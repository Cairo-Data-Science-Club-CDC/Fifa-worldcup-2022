[["cost-of-hosting-world-cup.html", "2 Cost of hosting world cup", " 2 Cost of hosting world cup Let’s start by loading the libraries that we’ll utilize in our analysis #web scrapping library(rvest) #everything tidy? library(tidyverse) #handling spatial-data library(rnaturalearth) library(rnaturalearthdata) library(sf) library(ggflags) library(ggspatial) library(giscoR) library(rasterpic) library(countrycode) #adding flags in ggplot library(ggimage) #Visually explore data tables library(visdat) #fit text within a defined area library(ggfittext) #set the default ggplot theme theme_set(cowplot::theme_cowplot()) #get image wc_img &lt;- here::here(&quot;images/wc12.png&quot;) #define function to control transparency and set to 0.2 transparent &lt;- function(img) { magick::image_fx(img, expression = &quot;0.1*a&quot;, channel = &quot;alpha&quot;) } # get flags form this repo flagrepo &lt;- &quot;https://raw.githubusercontent.com/hjnilsson/country-flags/master/png250px/&quot; # # Extract the amount of money url_2 &lt;- &quot;https://en.wikipedia.org/wiki/Economics_of_the_FIFA_World_Cup&quot; tbls_lst_2 &lt;- url_2 %&gt;% read_html %&gt;% html_table() # df_4 &lt;- tbls_lst_2[[2]] %&gt;% janitor::clean_names() %&gt;% mutate(host = str_replace(host, &quot;/\\\\s&quot;, &quot;-&quot;)) %&gt;% extract(host, c(&quot;country&quot;,&quot;year&quot;), &quot;([A-Z-]+) (\\\\([0-9]+\\\\))&quot;) %&gt;% separate_rows(country,sep = &quot;-&quot;) %&gt;% mutate(year = parse_number(year), #x = strex::str_first_currency(general_cost)[[4]], x = parse_number(general_cost), y = ifelse(str_detect(general_cost, &quot;million&quot;),x/1000,x)) df_4$iso2 &lt;- countrycode(df_4$country, &quot;ioc&quot;, &quot;iso2c&quot;) ggplot()+ geom_col(data = df_4 %&gt;% distinct(year, y), aes(year, y), fill = &quot;grey90&quot;, color = &quot;black&quot;, size = 1)+ geom_text(data = df_4 %&gt;% distinct(year, y), aes(year, y, label = y), size = 5, nudge_y = 8)+ scale_y_continuous(breaks = c(1,10,100,200))+ labs(y = &quot;Billion $&quot;) ## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0. ## ℹ Please use `linewidth` instead. ggplot()+ geom_col(data = df_4 %&gt;% distinct(year, y), aes(year, y))+ geom_text(data = df_4 %&gt;% distinct(year, y) %&gt;% mutate(y2 =y, y = glue::glue(&quot;${y} bn&quot;)), aes(year, y2, label = y), size = 4, nudge_y = 20)+ ggimage::geom_flag(data = df_4 %&gt;% filter(!country %in% c(&quot;JPN&quot;, &quot;KOR&quot;)), aes(year, y+8, image = iso2), size = 0.07)+ ggimage::geom_flag(data = df_4 %&gt;% filter(country %in% c(&quot;JPN&quot;, &quot;KOR&quot;)) %&gt;% mutate(year=ifelse(str_detect(country, &quot;JPN&quot;), year+1.5, year)), aes(year-0.7, y+8, image = iso2), size = 0.05)+ ggpattern::geom_col_pattern(data = df_4 %&gt;% distinct(year, y), aes(year, y), pattern_filename = I(&quot;images/Gold-Dollar-Sign-PNG-HD.png&quot;), pattern = &#39;image&#39;, pattern_type = &#39;tile&#39;, pattern_scale = -1, fill = &quot;#a1d99b&quot; )+ ggimage::geom_image(data = data.frame(x = 1995, y = 120), aes(x,y), image = wc_img,image_fun = transparent, size = 1.2)+ scale_x_continuous(breaks = unique(df_4$year))+ scale_y_continuous(breaks = c(1,10,100,200))+ labs(y = &quot;&quot;, x = &quot;&quot;)+ theme(plot.background = element_rect(fill = &quot;#e5f5e0&quot;), panel.background = element_rect(fill = &quot;#e5f5e0&quot;), panel.grid.major = element_line(colour = &quot;#e5f5e0&quot;), axis.line = element_blank(), axis.ticks = element_blank(), axis.text.y = element_blank()) flags &lt;- c() # Loop and add for (iso in df_4$iso2) { # Download pic and plot imgurl &lt;- paste0(flagrepo, tolower(iso), &quot;.png&quot;) tmpfile &lt;- tempfile(fileext = &quot;.png&quot;) download.file(imgurl, tmpfile, quiet = TRUE, mode = &quot;wb&quot;) flags &lt;- c(flags, tmpfile) } ggplot()+ ggimage::geom_image(data = expand_grid(x = c(seq(1990, 2022,length.out = 6)), y = c(1, 10, 100)), aes(x,y), image = &quot;images/Gold-Dollar-Sign-PNG-HD.png&quot;,image_fun = transparent, size = 0.3)+ ggpattern::geom_col_pattern(data = df_4 , aes(year, y, fill = country), position = position_dodge(), pattern_gravity = I(&quot;West&quot;), pattern_filename = I(flags), pattern = &#39;image&#39;, pattern_type = &#39;tile&#39;, pattern_scale = -1, show.legend = FALSE)+ scale_y_continuous(breaks = c(1,10,100,200), trans = scales::pseudo_log_trans(base = 10))+ scale_x_continuous(breaks = unique(df_4$year))+ geom_text(data = df_4 %&gt;% distinct(year, y) %&gt;% mutate(y2 = y+(y*0.45), y = glue::glue(&quot;${y} bn&quot;)), aes(year, y2, label = y), size = 4)+ geom_text(data = df_4%&gt;% arrange(country) %&gt;% group_by(year) %&gt;% summarise(iso2 = paste(iso2, collapse = &quot;-&quot;)), aes(year, label = iso2), y = -0.07, size = 4)+ labs(y = &quot;&quot;, x = &quot;&quot;)+ theme(plot.background = element_rect(fill = &quot;#e5f5e0&quot;), panel.background = element_rect(fill = &quot;#e5f5e0&quot;), panel.grid.major = element_line(colour = &quot;#e5f5e0&quot;), axis.line = element_blank(), axis.ticks = element_blank(), axis.text.y = element_blank()) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
